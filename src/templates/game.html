<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twordle-Dee</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/cdn/stylesheets/bootstrap.css">

    <style>
        .letter-block {
            width: min(15vw, 100px);
            height: min(15vw, 100px);
            display: inline-block;
        }

        .bg-green {
            background-color: rgb(31, 105, 31);
            color: white;

        }

        .bg-gray {
            background-color: rgb(55, 55, 55);
            color: white;

        }

        .bg-yellow {
            background-color: rgb(207, 207, 55);
            color: white;
        }
    </style>
</head>

<body>

    <div class="border text-center container-fluid" id="guess-holder">
    </div>


    <div>
        <p id="response"></p>
        <div class="input-group mb-3">
            <input id="guess" type="text" class="form-control" placeholder="Guess" autofocus>
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" onclick="makeGuess()">Guess</button>
            </div>
        </div>
    </div>


    <script>

        let sendGuess = async (guess) => {
            let headers = new Headers();
            headers.append("Content-Type", "application/json");

            let raw = JSON.stringify({
                "guess": guess
            });

            let requestOptions = {
                method: 'POST',
                headers: headers,
                body: raw,
                redirect: 'follow'
            };



            const response = await fetch("api/guess", requestOptions)
            return response.json()
        }

        let makeGuess = () => {
            let guess = document.getElementById('guess').value
            let message = document.getElementById('response')
            sendGuess(guess)
                .then(data => {
                    message.classList.remove('text-danger')
                    message.innerHTML = ''
                    generateColouredGuess(guess, data.colour)
                })
                .catch(error => {
                    message.classList.add('text-danger')
                    message.innerHTML = "Invalid Input"
                })

        }

        /*
        <div class="pb-1">
            <div class="card card-body  letter-block bg-green">
                <h1>C</h1>
            </div>
            <div class="card card-body letter-block bg-yellow">
                <h1>A</h1>
            </div>
            <div class="card card-body letter-block bg-gray">
                <h1>A</h1>
            </div>
            <div class="card card-body letter-block bg-gray">
                <h1>A</h1>
            </div>
            <div class="card card-body letter-block bg-gray">
                <h1>A</h1>
        </div>
        */
        let generateColouredGuess = (guess, colours) => {
            let out = document.createElement("div")
            out.classList.add(['pb-1'])

            guess = guess.toUpperCase()

            for (let i = 0; i < colours.length; i++) {
                let block = document.createElement("div")
                block.classList.add('card', 'card-body', 'letter-block', 'bg-'+colours[i])
                let letter = document.createElement("h1")
                letter.innerHTML = guess.charAt(i)

                block.appendChild(letter)
                out.appendChild(block)
            }

            document.getElementById('guess-holder').appendChild(out)
            document.getElementById('guess').value = ''
        }


        window.onload = () => {
            document.getElementById('guess').addEventListener('keypress', function(event){
                if(event.key === 'Enter'){
                    makeGuess()
                    document.getElementById('guess').focus()
                }
            })
        }



    </script>

</body>

</html>